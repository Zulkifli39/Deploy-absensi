generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

model users {
  user_id                Int                    @id @default(autoincrement())
  email                  String                 @unique
  national_id_number     String?                @unique
  employee_id_number     String?                @unique
  password_hash          String
  phone_number           String?
  display_name           String?
  department_id          Int?
  sub_department_id      Int?
  user_role_id           Int?
  location_id            Int?
  avatar                 String?
  created_at             DateTime               @default(now())
  updated_at             DateTime               @updatedAt
  deleted_at             DateTime?
  is_active              Boolean                @default(true)
  reset_password_expires DateTime?
  reset_password_token   String?
  attendances            attendances[]
  information            information[]          @relation("information_created_by")
  user_details           user_details?
  user_faces             user_faces[]
  user_shift_schedules   user_shift_schedules[]
  leave_requests         leave_requests[]
  department             departments?           @relation(fields: [department_id], references: [department_id])
  location               locations?             @relation(fields: [location_id], references: [location_id])
  sub_department         sub_departments?       @relation(fields: [sub_department_id], references: [sub_department_id])
  user_role              user_roles?            @relation(fields: [user_role_id], references: [user_role_id])
  overtime_requests overtime_requests[]
  approved_overtimes overtime_requests[] @relation("OvertimeApprovedBy")
  @@index([department_id], map: "users_department_id_fkey")
  @@index([location_id], map: "users_location_id_fkey")
  @@index([sub_department_id], map: "users_sub_department_id_fkey")
  @@index([user_role_id], map: "users_user_role_id_fkey")
  
}

model user_details {
  user_detail_id     Int              @id @default(autoincrement())
  user_id            Int              @unique
  title_prefix       String?
  full_name          String?
  title_suffix       String?
  gender             String?
  birth_date         DateTime?
  address            String?
  employee_status_id Int?
  hire_date          DateTime?
  termination_date   DateTime?
  created_at         DateTime         @default(now())
  updated_at         DateTime         @updatedAt
  deleted_at         DateTime?
  employee_status    employee_status? @relation(fields: [employee_status_id], references: [employee_status_id])
  user               users            @relation(fields: [user_id], references: [user_id])

  @@index([employee_status_id], map: "user_details_employee_status_id_fkey")
}

model locations {
  location_id   Int           @id @default(autoincrement())
  location_name String
  address       String?
  latitude      Decimal?
  longitude     Decimal?
  radius_meter  Int?
  is_active     Boolean       @default(true)
  created_at    DateTime      @default(now())
  updated_at    DateTime      @updatedAt
  deleted_at    DateTime?
  attendances   attendances[]
  users         users[]
}

model departments {
  department_id   Int               @id @default(autoincrement())
  department_name String
  is_active       Boolean           @default(true)
  created_at      DateTime          @default(now())
  updated_at      DateTime          @updatedAt
  shifts          shifts[]
  sub_departments sub_departments[]
  users           users[]
  overtime_requests overtime_requests[]
}

model sub_departments {
  sub_department_id   Int         @id @default(autoincrement())
  department_id       Int
  sub_department_name String
  is_active           Boolean     @default(true)
  created_at          DateTime    @default(now())
  updated_at          DateTime    @updatedAt
  department          departments @relation(fields: [department_id], references: [department_id])
  users               users[]

  @@index([department_id], map: "sub_departments_department_id_fkey")
}

model user_roles {
  user_role_id   Int      @id @default(autoincrement())
  user_role_name String   @unique
  is_active      Boolean  @default(true)
  created_at     DateTime @default(now())
  updated_at     DateTime @updatedAt
  users          users[]
}

model employee_status {
  employee_status_id Int            @id @default(autoincrement())
  status_name        String
  description        String?
  is_active          Boolean        @default(true)
  created_at         DateTime       @default(now())
  updated_at         DateTime       @updatedAt
  user_details       user_details[]
}

model user_faces {
  user_face_id   Int       @id @default(autoincrement())
  user_id        Int
  face_image_url String
  created_at     DateTime  @default(now())
  deleted_at     DateTime?
  descriptor     String?   @db.Text
  user           users     @relation(fields: [user_id], references: [user_id])

  @@index([user_id], map: "user_faces_user_id_fkey")
}

model attendances {
  attendance_id       Int               @id @default(autoincrement())
  user_id             Int
  shift_id            Int?
  period_id           Int?
  location_id         Int?
  attendance_date     DateTime
  checkin_time        DateTime?
  checkout_time       DateTime?
  checkin_latitude    Decimal?
  checkin_longitude   Decimal?
  checkin_distance    Float?
  checkout_latitude   Decimal?
  checkout_longitude  Decimal?
  checkout_distance   Float?
  checkin_photo_url   String?
  checkout_photo_url  String?
  attendance_method   String?
  late_minutes        Int?
  late_level          String?
  is_late             Boolean           @default(false)
  early_leave_minutes Int?
  early_leave_level   String?
  is_early_leave      Boolean           @default(false)
  attendance_status   String?
  is_reguler          Boolean           @default(false)
  created_at          DateTime          @default(now())
  updated_at          DateTime          @updatedAt
  location            locations?        @relation(fields: [location_id], references: [location_id])
  period              schedule_periods? @relation(fields: [period_id], references: [period_id])
  shift               shifts?           @relation(fields: [shift_id], references: [shift_id])
  user                users             @relation(fields: [user_id], references: [user_id])

  @@unique([user_id, attendance_date])
  @@index([attendance_date])
  @@index([location_id], map: "attendances_location_id_fkey")
  @@index([period_id], map: "attendances_period_id_fkey")
  @@index([shift_id], map: "attendances_shift_id_fkey")
}

model information {
  information_id Int       @id @default(autoincrement())
  title          String
  image          String?
  pdf_file_url   String?
  description    String?   @db.Text
  created_by     Int
  is_published   Boolean   @default(false)
  created_at     DateTime  @default(now())
  updated_at     DateTime  @updatedAt
  deleted_at     DateTime?
  user           users     @relation("information_created_by", fields: [created_by], references: [user_id])
  @@index([created_by], map: "information_created_by_fkey")
}

model shifts {
  shift_id             Int                    @id @default(autoincrement())
  department_id        Int
  shift_code           String                 @unique
  shift_name           String
  shift_type           String
  checkin_time         String
  checkout_time        String
  is_next_day          Boolean                @default(false)
  created_at           DateTime               @default(now())
  attendances          attendances[]
  shift_days           shift_days[]
  department           departments            @relation(fields: [department_id], references: [department_id])
  user_shift_schedules user_shift_schedules[]

  @@index([department_id], map: "shifts_department_id_fkey")
}

model schedule_periods {
  period_id            Int                    @id @default(autoincrement())
  period_name          String
  start_date           DateTime
  end_date             DateTime
  created_by           Int
  is_locked            Boolean                @default(false)
  created_at           DateTime               @default(now())
  attendances          attendances[]
  user_shift_schedules user_shift_schedules[]
}

model user_shift_schedules {
  user_shift_schedule_id Int              @id @default(autoincrement())
  user_id                Int
  shift_id               Int
  period_id              Int
  schedule_date          DateTime
  created_at             DateTime         @default(now())
  period                 schedule_periods @relation(fields: [period_id], references: [period_id])
  shift                  shifts           @relation(fields: [shift_id], references: [shift_id])
  user                   users            @relation(fields: [user_id], references: [user_id])

  @@unique([user_id, schedule_date])
  @@index([period_id], map: "user_shift_schedules_period_id_fkey")
  @@index([shift_id], map: "user_shift_schedules_shift_id_fkey")
}

model shift_days {
  shift_day_id  Int      @id @default(autoincrement())
  shift_id      Int
  day_of_week   String
  checkin_time  String
  checkout_time String
  tolerance_time Int?
  is_next_day   Boolean  @default(false)
  created_at    DateTime @default(now())
  updated_at    DateTime @updatedAt
  shift         shifts   @relation(fields: [shift_id], references: [shift_id])

  @@index([shift_id], map: "shift_days_shift_id_fkey")
}

model leave_types {
  leave_type_id       Int              @id @default(autoincrement())
  name                String
  description         String?
  requires_attachment Boolean          @default(false)
  is_active           Boolean          @default(true)
  created_at          DateTime         @default(now())
  updated_at          DateTime         @updatedAt
  leave_requests      leave_requests[]
}

model leave_requests {
  leave_id         Int         @id @default(autoincrement())
  user_id          Int
  leave_type_id    Int
  start_date       DateTime
  end_date         DateTime
  description      String?
  attachment_url   String?
  status           String      @default("pending") // pending, approved, rejected
  rejection_reason String?
  approved_by      Int?
  approved_at      DateTime?
  created_at       DateTime    @default(now())
  updated_at       DateTime    @updatedAt
  
  user             users       @relation(fields: [user_id], references: [user_id])
  leave_type       leave_types @relation(fields: [leave_type_id], references: [leave_type_id])
  
  @@index([user_id])
  @@index([leave_type_id])
}

model overtime_requests {
  overtime_id     Int      @id @default(autoincrement())
  user_id         Int
  user            users    @relation(fields: [user_id], references: [user_id])
  department_id   Int
  department      departments @relation(fields: [department_id], references: [department_id])
  start_time      DateTime
  end_time        DateTime?
  total_minutes   Int
  start_photo     String?   // path / url foto mulai lembur
  end_photo       String?   // path / url foto selesai lembur
  reason          String?   @db.Text
  status          OvertimeStatus @default(PENDING)
  
  approved_by     Int?
  approved_by_user users?   @relation("OvertimeApprovedBy", fields: [approved_by], references: [user_id])
  approved_at     DateTime?
  created_at      DateTime @default(now())
  updated_at      DateTime @updatedAt
  deleted_at      DateTime?
  @@index([user_id, start_time])
  @@index([department_id])
  @@index([status])

  
}
enum OvertimeStatus {
  PENDING
  APPROVED
  REJECTED
}
